<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horario Tem√°tico Personalizable</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap');

  /* --- DEFINICI√ìN DE VARIABLES (TEMA POR DEFECTO: MELODY) --- */
  :root {
      --bg-body: #ffecec;
      --panel-bg: white;
      --primary: #ec407a;       
      --primary-dark: #d81b60;  
      --secondary: #f8cddf;     
      --secondary-light: #fff0f6; 
      --border: #f8bbd0;        
      --text: #880e4f;          
      --text-white: #ffffff;
      --bg-pattern: url('https://i.pinimg.com/originals/a7/22/74/a72274070b833bfa673f4c0731869ff7.png');
  }

  /* --- ESTRUCTURA PRINCIPAL --- */
  body {
      background-color: var(--bg-body);
      font-family: 'Quicksand', sans-serif;
      margin: 0; padding: 20px;
      display: flex; flex-direction: row; gap: 20px;
      min-height: 100vh; box-sizing: border-box;
      transition: background-color 0.5s ease;
  }

  /* --- PANEL DE CONTROL --- */
  .control-panel {
      background: var(--panel-bg);
      padding: 20px; border-radius: 20px;
      width: 300px; height: fit-content;
      box-shadow: 0 5px 15px rgba(0,0,0, 0.1);
      border: 2px solid var(--border);
      flex-shrink: 0; 
  }
  .control-panel h2 { color: var(--primary-dark); text-align: center; margin-top: 0; }
  .input-group { margin-bottom: 15px; }
  label { display: block; color: var(--text); font-weight: bold; margin-bottom: 5px; font-size: 14px; }
  
/* --- AGREGAR ESTO EN EL CSS --- */
.dias-checkboxes {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 5px;
}
.dias-checkboxes label {
    font-weight: normal;
    font-size: 13px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 2px;
}


  input, select {
      width: 100%; padding: 10px; border: 2px solid var(--border);
      border-radius: 10px; font-family: 'Quicksand', sans-serif;
      box-sizing: border-box; outline: none; color: var(--text);
  }
  
  button.btn-add {
      width: 100%; background-color: var(--primary); color: var(--text-white);
      border: none; padding: 12px; border-radius: 12px;
      font-weight: bold; cursor: pointer; transition: background 0.3s; margin-bottom: 5px;
  }
  button.btn-add:hover { background-color: var(--primary-dark); }
  
  .lista-materias { margin-top: 10px; max-height: 250px; overflow-y: auto; }
  .item-materia {
      background: var(--secondary-light); border: 1px solid var(--border); padding: 8px;
      border-radius: 8px; margin-bottom: 5px; font-size: 12px;
      display: flex; justify-content: space-between; align-items: center; color: var(--text);
  }
  .btn-delete {
      background: #ff5252; color: white; border: none; border-radius: 5px;
      padding: 2px 6px; cursor: pointer; font-size: 10px;
  }

  /* --- √ÅREA DE VISUALIZACI√ìN --- */
  .preview-area {
      flex-grow: 1; display: flex; justify-content: center; align-items: flex-start;
  }

  .melody-schedule-container {
    background-color: var(--secondary);
    /* Patr√≥n de puntos gen√©rico */
    background-image: radial-gradient(#ffffff 20%, transparent 20%), radial-gradient(#ffffff 20%, transparent 20%);
    background-position: 0 0, 10px 10px; background-size: 20px 20px;
    
    padding: 20px; border-radius: 30px;
    border: 4px dashed var(--border);
    width: 100%; max-width: 900px; min-height: 500px; 
    position: relative; z-index: 1; overflow: hidden;
    transition: all 0.5s ease;
    -webkit-print-color-adjust: exact; print-color-adjust: exact; 
  }

  /* Imagen de fondo del personaje grande */
  .melody-schedule-container::before {
      content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-image: var(--bg-pattern);
      background-repeat: no-repeat; background-position: center bottom;
      background-size: 50%; opacity: 0.6; z-index: -1; pointer-events: none;
      transition: background-image 0.5s ease;
  }

  h1 {
    text-align: center; color: #ffffff; text-transform: uppercase;
    text-shadow: 3px 3px 0 var(--primary), -1px -1px 0 var(--primary), 1px -1px 0 var(--primary);
    font-size: 26px; letter-spacing: 2px; margin-bottom: 10px;
  }

  .table-scroll-wrapper { width: 100%; overflow-x: auto; }
  table { width: 100%; border-collapse: separate; border-spacing: 4px; table-layout: fixed; }
  
  .character-header td { 
      background: transparent !important; border: none !important; 
      text-align: center; vertical-align: bottom; height: 70px; 
  }
  .melody-icon { 
      height: 60px; width: 100%; object-fit: contain; 
      display: block; margin: 0 auto; 
      filter: drop-shadow(2px 2px 0px rgba(255,255,255,0.5));
  }

  th {
    background-color: var(--primary); color: var(--text-white); padding: 8px 2px; border-radius: 10px;
    font-size: 13px; text-transform: uppercase; border: 2px solid var(--primary-dark);
  }
  td {
    background-color: rgba(255, 255, 255, 0.75); padding: 4px; border-radius: 10px;
    text-align: center; font-size: 11px; border: 2px solid var(--border);
    height: 45px; vertical-align: middle; color: var(--text); overflow: hidden;
  }
  
  .time-col {
    background-color: var(--border); color: var(--text); font-weight: bold; width: 50px; border: 2px solid var(--primary);
  }
  
  .materia { font-weight: 700; display: block; line-height: 1.1; font-size: 10px; margin-bottom: 3px; }
  .salon {
      display: inline-block; font-size: 9px; color: var(--primary-dark);
      background-color: rgba(255, 255, 255, 0.8); border-radius: 4px; padding: 1px 4px; border: 1px solid var(--border);
  }
  .empty { background-color: rgba(255, 255, 255, 0.3); border: 2px dashed var(--border); }

  .day-long { display: inline; }
  .day-short { display: none; }

  @media print {
      @page { size: portrait; margin: 0.5cm; }
      body { background-color: white; display: block; padding: 0; margin: 0; }
      .control-panel, .btn-add { display: none !important; }
      .preview-area { display: block; width: 100%; margin: 0; padding: 0; }
      .melody-schedule-container {
          width: 100% !important; max-width: none !important;
          border: 4px dashed var(--border); margin: 0 auto; box-shadow: none;
          transform: scale(0.70); transform-origin: top center; 
      }
      .melody-schedule-container::before { opacity: 0.4; } 
      .day-long { display: inline !important; }
      .day-short { display: none !important; }
  }

  @media screen and (max-width: 900px) {
      body { flex-direction: column; align-items: center; }
      .control-panel { width: 90%; max-width: 400px; margin-bottom: 20px; }
      .day-long { display: none; }
      .day-short { display: inline; }
  }
</style>
</head>
<body>

  <div class="control-panel">
      <h2>üå∏ Agregar Clase üå∏</h2>
      
      <div class="input-group">
          <label>üé® Elige tu Tema:</label>
          <select id="inpTema" onchange="cambiarTema()">
              <option value="melody">My Melody</option>
              <option value="pucca">Pucca</option>
              <option value="winx">Winx Club</option>
              <option value="gatos">Gatitos</option>
              <option value="capibara">Capibaras</option>
          </select>
      </div>
      <hr style="border: 1px dashed #ccc; margin-bottom: 15px;">

      <div class="input-group">
          <label>Materia:</label>
          <input type="text" id="inpMateria" placeholder="Ej. Fisicoquimica I" maxlength="20">
      </div>
      
      <div class="input-group">
          <label>Sal√≥n:</label>
          <input type="text" id="inpSalon" placeholder="Ej. FIQ1-101" maxlength="10">
      </div>
      
      <div class="input-group">
         <label>D√≠as:</label>
            <div class="dias-checkboxes">
                <label><input type="checkbox" name="dia" value="Lunes"> Lun</label>
                <label><input type="checkbox" name="dia" value="Martes"> Mar</label>
                <label><input type="checkbox" name="dia" value="Mi√©rcoles"> Mi√©</label>
                <label><input type="checkbox" name="dia" value="Jueves"> Jue</label>
                <label><input type="checkbox" name="dia" value="Viernes"> Vie</label>
            </div>
        </div>
      
      <div class="input-group" style="display: flex; gap: 10px;">
          <div style="flex:1;">
              <label>Inicio (Hrs):</label>
              <input type="number" id="inpInicio" min="7" max="20" value="7">
          </div>
          <div style="flex:1;">
              <label>Fin (Hrs):</label>
              <input type="number" id="inpFin" min="8" max="21" value="9">
          </div>
      </div>

      <button class="btn-add" onclick="agregarClase()">‚ú® Agregar al Horario</button>
      <button class="btn-add" style="background-color: #42a5f5;" onclick="window.print()">üñ®Ô∏è Imprimir PDF</button>
      <button class="btn-add" style="background-color: #78909c; margin-top: 5px;" onclick="reiniciarHorario()">üóëÔ∏è Borrar Todo</button>

      <div class="lista-materias" id="listaMaterias"></div>
      <p style="text-align: center; font-size: 10px; color: #888;">Si no carga la imagen al imprimir, marca "Gr√°ficos de fondo" en opciones.</p>
  </div>

  <div class="preview-area">
      <div class="melody-schedule-container" id="scheduleContainer">
          <h1>üéÄ Mi Horario de Clases üéÄ</h1>
          <div class="table-scroll-wrapper">
              <table id="tablaHorario">
                  </table>
          </div> 
      </div>
  </div>

<script>
    let clases = [];
    const diasCompletos = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes"];
    const diasCortos = ["L", "M", "M", "J", "V"]; 

    // --- CONFIGURACI√ìN DE TEMAS ---
    const temas = {
        melody: {
            colors: {
                '--bg-body': '#ffecec',
                '--primary': '#ec407a',
                '--primary-dark': '#d81b60',
                '--secondary': '#f8cddf',
                '--secondary-light': '#fff0f6',
                '--border': '#f8bbd0',
                '--text': '#880e4f',
                '--bg-pattern': "url('https://i.pinimg.com/originals/a7/22/74/a72274070b833bfa673f4c0731869ff7.png')"
            },
            icons: [
                "https://img1.picmix.com/output/stamp/normal/7/1/7/7/2607717_54ba1.png",
                "https://i.pinimg.com/originals/99/52/36/99523638bfc01dbbbdbc2e00d52c9d90.png",
                "https://cdn.sanriowiki.com/3/38/My_Melody_happy.png", 
                "https://img1.picmix.com/output/stamp/normal/9/1/7/3/2553719_26b60.png",
                "kuromi.png"
            ]
        },
        pucca: {
            colors: {
                '--bg-body': '#ffebee',
                '--primary': '#d32f2f',
                '--primary-dark': '#b71c1c',
                '--secondary': '#ffcdd2',
                '--secondary-light': '#ffffff',
                '--border': '#ef5350',
                '--text': '#212121',
                '--bg-pattern': "url('https://puccaweb.com/img/slider-01a.png')" 
            },
            icons: [
                "https://www.pikpng.com/pngl/b/490-4908169_pucca-sonriente-y-feliz-imagenes-pucca-pucca-clipart.png",
                "garu.png", 
                "puca2.png",
                "puca3.png",
                "pucabeso.png"
            ]
        },
        winx: {
            colors: {
                '--bg-body': '#f3e5f5',
                '--primary': '#ab47bc',
                '--primary-dark': '#7b1fa2',
                '--secondary': '#e1bee7',
                '--secondary-light': '#ffffff',
                '--border': '#ce93d8',
                '--text': '#4a148c',
                '--bg-pattern': "url('winx.png')"
            },
            icons: [
                "winx1.png",
                "winx2.png",
                "winx3.png",
                "winx4.png",
                "winx5.png"
            ]
        },
        gatos: {
            colors: {
                '--bg-body': '#fff3e0',
                '--primary': '#ff9800',
                '--primary-dark': '#f57c00',
                '--secondary': '#ffe0b2',
                '--secondary-light': '#fff',
                '--border': '#ffcc80',
                '--text': '#e65100',
                '--bg-pattern': "url('fondogato.png')"
            },
            icons: [
                "gato1.png",
                "gato2.png",
                "gato3.png",
                "gato4.png",
                "gato5.png"
            ]
        },
        capibara: {
            colors: {
                '--bg-body': '#e8f5e9',
                '--primary': '#558b2f',
                '--primary-dark': '#33691e',
                '--secondary': '#c8e6c9',
                '--secondary-light': '#fff',
                '--border': '#a5d6a7',
                '--text': '#1b5e20',
                '--bg-pattern': "url('capibara.png')"
            },
            icons: [
                "capibara1.png",
                "capibara2.png",
                "capibara3.png",
                "capibara4.png",
                "capibara5.png"
            ]
        }
    };

    let temaActual = "melody"; 

    function guardarEnMemoria() {
        // Guardamos la lista de materias convertida a texto
        localStorage.setItem('miHorario_clases', JSON.stringify(clases));
        // Guardamos tambi√©n el tema que elegiste (Melody, Pucca, etc.)
        localStorage.setItem('miHorario_tema', temaActual);
    }

    function reiniciarHorario() {
        if (confirm("¬øEst√°s seguro de que quieres borrar todo el horario?")) {
            clases = [];
            localStorage.removeItem('miHorario_clases');
            // Opcional: localStorage.removeItem('miHorario_tema'); si quieres reiniciar el tema tambi√©n
            renderizarLista();
            renderizarTabla();
        }
    }
    
    function cambiarTema() {
        const seleccion = document.getElementById('inpTema').value;
        const tema = temas[seleccion];
        temaActual = seleccion;

        // Cambiar variables CSS
        const root = document.documentElement;
        for (const [key, value] of Object.entries(tema.colors)) {
            root.style.setProperty(key, value);
        }
        
        // Refrescar tabla para actualizar √≠conos
        renderizarTabla();
        if (document.readyState === 'complete') {
             localStorage.setItem('miHorario_tema', seleccion);
        }
    }

    function agregarClase() {
        const materia = document.getElementById('inpMateria').value.trim();
        const salon = document.getElementById('inpSalon').value.trim();
        
        // --- CAMBIO: OBTENER TODOS LOS CHECKBOXES MARCADOS ---
        const checkboxes = document.querySelectorAll('input[name="dia"]:checked');
        const diasSeleccionados = Array.from(checkboxes).map(cb => cb.value);

        const inicio = parseInt(document.getElementById('inpInicio').value);
        const fin = parseInt(document.getElementById('inpFin').value);

        // Validaciones b√°sicas
        if(!materia) { alert("¬°Falta el nombre de la materia!"); return; }
        if(!salon) { alert("¬°Falta el sal√≥n!"); return; } 
        if(diasSeleccionados.length === 0) { alert("‚ö†Ô∏è Selecciona al menos un d√≠a."); return; } // Validaci√≥n nueva
        if (inicio < 7 || inicio > 20) { alert("‚ö†Ô∏è La hora de inicio debe ser entre las 7:00 y las 20:00."); return; }
        if (fin < 8 || fin > 21) { alert("‚ö†Ô∏è La hora de fin debe ser entre las 8:00 y las 21:00."); return; }
        if(fin <= inicio) { alert("La hora de fin debe ser mayor a la de inicio"); return; }
        
        const regexMateria = /^[a-zA-Z0-9√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s\.\-]+$/; 
        if (!regexMateria.test(materia)) { alert("‚ö†Ô∏è Error en Materia: Solo letras y n√∫meros."); return; }

        // --- VALIDACI√ìN DE CHOQUES PARA CADA D√çA SELECCIONADO ---
        for (let dia of diasSeleccionados) {
            const choque = clases.find(c => c.dia === dia && inicio < c.fin && c.inicio < fin);
            if (choque) { 
                alert(`‚ö†Ô∏è Choque el d√≠a ${dia} con la materia: ${choque.materia}`); 
                return; // Si hay choque en ALGUN d√≠a, no agrega nada
            }
        }

        // --- AGREGAR LA CLASE PARA CADA D√çA ---
        diasSeleccionados.forEach(dia => {
            clases.push({ id: Date.now() + Math.random(), materia, salon, dia, inicio, fin });
        });

        // Limpiar campos (opcional: puedes desmarcar los checkboxes si quieres)
        document.getElementById('inpMateria').value = "";
        document.getElementById('inpSalon').value = "";
        // Desmarcar casillas
        checkboxes.forEach(cb => cb.checked = false);

        renderizarLista();
        renderizarTabla();
        guardarEnMemoria();
    }

    function borrarClase(id) {
        clases = clases.filter(c => c.id !== id);
        renderizarLista();
        renderizarTabla();
        guardarEnMemoria();
    }

    function renderizarLista() {
        const contenedor = document.getElementById('listaMaterias');
        contenedor.innerHTML = "";
        clases.forEach(c => {
            contenedor.innerHTML += `
                <div class="item-materia">
                    <div><b>${c.materia}</b><br>${c.dia} ${c.inicio}:00 - ${c.fin}:00</div>
                    <button class="btn-delete" onclick="borrarClase(${c.id})">X</button>
                </div>
            `;
        });
    }

    function renderizarTabla() {
        const tabla = document.getElementById('tablaHorario');
        
        // Seleccionar √≠conos del tema actual
        const currentIcons = temas[temaActual].icons;

        // 1. Definimos un rango por defecto (solo si no hay clases)
        let minHora = 7; 
        let maxHora = 21;

        // 2. Si hay clases, ajustamos el rango exactamente a lo que necesitas
        if (clases.length > 0) {
            const inicios = clases.map(c => c.inicio); // Lista de horas de inicio
            const fines = clases.map(c => c.fin);      // Lista de horas de fin
            
            minHora = Math.min(...inicios); // La hora m√°s temprana
            maxHora = Math.max(...fines);   // La hora m√°s tard√≠a
        }

        let html = '<thead><tr class="character-header"><td></td>';
        for(let i=0; i<5; i++) {
            // Ciclar √≠conos si hay menos de 5
            const imgUrl = currentIcons[i % currentIcons.length]; 
            html += '<td><img src="' + imgUrl + '" class="melody-icon" alt="icon"></td>';
        }
        html += '</tr><tr><th class="time-header">Hora</th>';
        
        diasCompletos.forEach((dia, index) => {
            html += `<th><span class="day-long">${dia}</span><span class="day-short">${diasCortos[index]}</span></th>`;
        });
        html += '</tr></thead><tbody>';

        // 3. El ciclo ahora usa el minHora y maxHora din√°micos
        for(let h = minHora; h < maxHora; h++) {
            html += '<tr><td class="time-col">' + h + ':00</td>';
            diasCompletos.forEach(dia => {
                const claseFound = clases.find(c => c.dia === dia && h >= c.inicio && h < c.fin);
                if (claseFound) {
                    html += '<td><span class="materia">' + claseFound.materia + '</span><span class="salon">' + claseFound.salon + '</span></td>';
                } else {
                    html += `<td class="empty"></td>`;
                }
            });
            html += '</tr>';
        }
        html += '</tbody>';
        tabla.innerHTML = html;
    }

    window.onload = function() {
        // 1. Intentar recuperar el tema guardado
        const temaGuardado = localStorage.getItem('miHorario_tema');
        if (temaGuardado && temas[temaGuardado]) {
            document.getElementById('inpTema').value = temaGuardado;
        }
        
        // Aplicar el tema (sea el guardado o el por defecto)
        cambiarTema();

        // 2. Intentar recuperar las clases guardadas
        const clasesGuardadas = localStorage.getItem('miHorario_clases');
        if (clasesGuardadas) {
            // Convertir de texto a arreglo de JS
            clases = JSON.parse(clasesGuardadas);
            renderizarLista();
            renderizarTabla();
        }
    };
</script>
</body>
</html>