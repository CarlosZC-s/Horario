<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horario Melody Final (7-21 Hrs)</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap');

  /* --- 1. ESTRUCTURA PRINCIPAL --- */
  body {
      background-color: #ffecec;
      font-family: 'Quicksand', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: row; 
      gap: 20px;
      min-height: 100vh;
      box-sizing: border-box;
  }

  /* --- 2. PANEL DE CONTROL (IZQUIERDA) --- */
  .control-panel {
      background: white;
      padding: 20px;
      border-radius: 20px;
      width: 300px;
      height: fit-content;
      box-shadow: 0 5px 15px rgba(236, 64, 122, 0.2);
      border: 2px solid #f8bbd0;
      flex-shrink: 0; 
  }
  .control-panel h2 { color: #d81b60; text-align: center; margin-top: 0; }
  .input-group { margin-bottom: 15px; }
  label { display: block; color: #880e4f; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
  
  input, select {
      width: 100%; padding: 10px; border: 2px solid #f8bbd0;
      border-radius: 10px; font-family: 'Quicksand', sans-serif;
      box-sizing: border-box; outline: none;
  }
  
  button.btn-add {
      width: 100%; background-color: #ec407a; color: white;
      border: none; padding: 12px; border-radius: 12px;
      font-weight: bold; cursor: pointer; transition: background 0.3s; margin-bottom: 5px;
  }
  button.btn-add:hover { background-color: #d81b60; }
  
  .lista-materias { margin-top: 10px; max-height: 250px; overflow-y: auto; }
  .item-materia {
      background: #fff0f6; border: 1px solid #f8bbd0; padding: 8px;
      border-radius: 8px; margin-bottom: 5px; font-size: 12px;
      display: flex; justify-content: space-between; align-items: center;
  }
  .btn-delete {
      background: #ff5252; color: white; border: none; border-radius: 5px;
      padding: 2px 6px; cursor: pointer; font-size: 10px;
  }

  /* --- 3. √ÅREA DE VISUALIZACI√ìN (DERECHA) --- */
  .preview-area {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
  }

  .melody-schedule-container {
    background-color: #f8cddf;
    background-image: radial-gradient(#ffffff 20%, transparent 20%), radial-gradient(#ffffff 20%, transparent 20%);
    background-position: 0 0, 10px 10px;
    background-size: 20px 20px;
    
    padding: 20px;
    border-radius: 30px;
    border: 4px dashed #f48fb1;
    width: 100%;
    max-width: 900px;
    min-height: 500px; 
    
    position: relative; 
    z-index: 1;
    overflow: hidden;
    
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact; 
  }

  .melody-schedule-container::before {
      content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-image: url('https://i.pinimg.com/originals/a7/22/74/a72274070b833bfa673f4c0731869ff7.png');
      background-repeat: no-repeat; background-position: center bottom;
      background-size: 50%; opacity: 0.6; z-index: -1; pointer-events: none;
  }

  h1 {
    text-align: center; color: #ffffff; text-transform: uppercase;
    text-shadow: 3px 3px 0 #ec407a, -1px -1px 0 #ec407a, 1px -1px 0 #ec407a;
    font-size: 26px; letter-spacing: 2px; margin-bottom: 10px;
  }

  .table-scroll-wrapper { width: 100%; overflow-x: auto; }
  
  table { 
      width: 100%; border-collapse: separate; border-spacing: 4px; table-layout: fixed; 
  }
  
  .character-header td { 
      background: transparent !important; border: none !important; 
      text-align: center; vertical-align: bottom; height: 70px; 
  }
  .melody-icon { 
      height: 60px; width: 100%; object-fit: contain; 
      display: block; margin: 0 auto; 
  }

  th {
    background-color: #ec407a; color: white; padding: 8px 2px; border-radius: 10px;
    font-size: 13px; text-transform: uppercase; border: 2px solid #d81b60;
  }
  td {
    background-color: rgba(255, 249, 252, 0.65); padding: 4px; border-radius: 10px;
    text-align: center; font-size: 11px; border: 2px solid #f8bbd0;
    height: 45px; vertical-align: middle; color: #880e4f; overflow: hidden;
  }
  
  .time-col {
    background-color: #f48fb1; color: white; font-weight: bold; width: 50px; border: 2px solid #ec407a;
  }
  
  .materia { font-weight: 700; display: block; line-height: 1.1; font-size: 10px; margin-bottom: 3px; }
  .salon {
      display: inline-block; font-size: 9px; color: #ad1457;
      background-color: rgba(252, 228, 236, 0.8); border-radius: 4px; padding: 1px 4px;
  }
  .empty { background-color: rgba(255, 240, 245, 0.3); border: 2px dashed #f8bbd0; }

  /* --- TRUCO CSS PARA D√çAS LARGOS/CORTOS --- */
  .day-long { display: inline; }
  .day-short { display: none; }

  /* --- 5. CONFIGURACI√ìN DE IMPRESI√ìN --- */
  @media print {
      @page { size: portrait; margin: 0.5cm; }
      body { background-color: white; display: block; padding: 0; margin: 0; }
      .control-panel, .btn-add { display: none !important; }
      .preview-area { display: block; width: 100%; margin: 0; padding: 0; }
      .melody-schedule-container {
          width: 100% !important; max-width: none !important;
          border: 4px dashed #f48fb1; margin: 0 auto; box-shadow: none;
          transform: scale(0.70); transform-origin: top center; 
      }
      td { height: 40px; font-size: 10px; }
      .melody-icon { height: 50px; }

      /* IMPRIMIR SIEMPRE NOMBRE COMPLETO */
      .day-long { display: inline !important; }
      .day-short { display: none !important; }
  }

  /* --- 6. RESPONSIVE (CELULAR) --- */
  @media screen and (max-width: 900px) {
      body { flex-direction: column; align-items: center; }
      .control-panel { width: 90%; max-width: 400px; margin-bottom: 20px; }
      
      th { font-size: 11px; padding: 5px 1px; }
      td { font-size: 10px; padding: 2px; }
      .melody-schedule-container { padding: 10px; }

      /* En CELULAR: Se ve el corto, se oculta el largo */
      .day-long { display: none; }
      .day-short { display: inline; }
  }
</style>
</head>
<body>

  <div class="control-panel">
      <h2>üå∏ Agregar Clase üå∏</h2>
      
      <div class="input-group">
          <label>Materia:</label>
          <input type="text" id="inpMateria" placeholder="Ej. Bases de Datos" maxlength="20">
      </div>
      
      <div class="input-group">
          <label>Sal√≥n:</label>
          <input type="text" id="inpSalon" placeholder="Ej. CCO3-104" maxlength="10">
      </div>
      
      <div class="input-group">
          <label>D√≠a:</label>
          <select id="inpDia">
              <option value="Lunes">Lunes</option>
              <option value="Martes">Martes</option>
              <option value="Mi√©rcoles">Mi√©rcoles</option>
              <option value="Jueves">Jueves</option>
              <option value="Viernes">Viernes</option>
          </select>
      </div>
      
      <div class="input-group" style="display: flex; gap: 10px;">
          <div style="flex:1;">
              <label>Inicio (Hrs):</label>
              <input type="number" id="inpInicio" min="7" max="20" value="7">
          </div>
          <div style="flex:1;">
              <label>Fin (Hrs):</label>
              <input type="number" id="inpFin" min="8" max="21" value="9">
          </div>
      </div>

      <button class="btn-add" onclick="agregarClase()">‚ú® Agregar al Horario</button>
      <button class="btn-add" style="background-color: #42a5f5;" onclick="window.print()">üñ®Ô∏è Imprimir PDF</button>

      <div class="lista-materias" id="listaMaterias"></div>
      <p style="text-align: center; font-size: 10px; color: #888;">Si no carga la imagen al imprimir, marca "Gr√°ficos de fondo" en opciones.</p>
  </div>

  <div class="preview-area">
      <div class="melody-schedule-container" id="scheduleContainer">
          <h1>üéÄ Mi Horario de Clases üéÄ</h1>
          <div class="table-scroll-wrapper">
              <table id="tablaHorario">
                  </table>
          </div> 
      </div>
  </div>

<script>
    let clases = [];
    const diasCompletos = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes"];
    const diasCortos = ["L", "M", "M", "J", "V"]; 

    const images = [
        "https://img1.picmix.com/output/stamp/normal/7/1/7/7/2607717_54ba1.png",
        "https://i.pinimg.com/originals/99/52/36/99523638bfc01dbbbdbc2e00d52c9d90.png",
        "https://static.wikia.nocookie.net/doblaje/images/1/1c/My_melody.png/revision/latest?cb=20230608182814&path-prefix=es",
        "https://img1.picmix.com/output/stamp/normal/9/1/7/3/2553719_26b60.png",
        "https://cdn.sanriowiki.com/3/38/My_Melody_happy.png"
    ];

    function agregarClase() {
        const materia = document.getElementById('inpMateria').value.trim();
        const salon = document.getElementById('inpSalon').value.trim();
        const dia = document.getElementById('inpDia').value;
        const inicio = parseInt(document.getElementById('inpInicio').value);
        const fin = parseInt(document.getElementById('inpFin').value);

        // --- VALIDACIONES ACTUALIZADAS ---

        // 1. Campos Obligatorios
        if(!materia) { alert("¬°Falta el nombre de la materia!"); return; }
        if(!salon) { alert("¬°Falta el sal√≥n!"); return; } 

        // ---------------------------------------------------------
        //  AQU√ç EST√Å EL ARREGLO (VALIDACI√ìN DE RANGO 7 - 21)
        // ---------------------------------------------------------
        if (inicio < 7 || inicio > 20) {
            alert("‚ö†Ô∏è La hora de inicio debe ser entre las 7:00 y las 20:00.");
            return;
        }
        if (fin < 8 || fin > 21) {
            alert("‚ö†Ô∏è La hora de fin debe ser entre las 8:00 y las 21:00.");
            return;
        }
        // ---------------------------------------------------------

        // 2. L√≥gica Horaria (Inicio vs Fin)
        if(fin <= inicio) { alert("La hora de fin debe ser mayor a la de inicio"); return; }

        // 3. Formato Materia
        const regexMateria = /^[a-zA-Z0-9√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/;
        if (!regexMateria.test(materia)) { alert("‚ö†Ô∏è Error en Materia: Solo letras y n√∫meros."); return; }

        // 4. Formato Sal√≥n
        const regexSalon = /^[a-zA-Z0-9\-]+$/;
        if (!regexSalon.test(salon)) { alert("‚ö†Ô∏è Error en Sal√≥n: Solo letras, n√∫meros y guiones."); return; }

        // 5. Choques
        const choque = clases.find(c => c.dia === dia && inicio < c.fin && c.inicio < fin);
        if (choque) { alert("‚ö†Ô∏è Choque con: " + choque.materia); return; }

        clases.push({ id: Date.now(), materia, salon, dia, inicio, fin });
        document.getElementById('inpMateria').value = "";
        document.getElementById('inpSalon').value = "";
        renderizarLista();
        renderizarTabla();
    }

    function borrarClase(id) {
        clases = clases.filter(c => c.id !== id);
        renderizarLista();
        renderizarTabla();
    }

    function renderizarLista() {
        const contenedor = document.getElementById('listaMaterias');
        contenedor.innerHTML = "";
        clases.forEach(c => {
            contenedor.innerHTML += `
                <div class="item-materia">
                    <div><b>${c.materia}</b><br>${c.dia} ${c.inicio}:00 - ${c.fin}:00</div>
                    <button class="btn-delete" onclick="borrarClase(${c.id})">X</button>
                </div>
            `;
        });
    }

    function renderizarTabla() {
        const tabla = document.getElementById('tablaHorario');
        
        // CAMBIO 2: L√≠mite extendido a 21 horas por defecto
        let minHora = 7; let maxHora = 21;
        
        if (clases.length > 0) {
            const inicios = clases.map(c => c.inicio);
            const fines = clases.map(c => c.fin);
            minHora = Math.min(...inicios); 
            // Aseguramos que si las clases terminan antes, el max se ajuste a ellas, 
            // pero si quieres que SIEMPRE se vea hasta las 21 aunque est√© vac√≠o, 
            // la l√≥gica de abajo lo expandir√° si hay una clase tarde.
            // Para mantenerlo din√°mico pero capaz de llegar a 21:
            maxHora = Math.max(21, ...fines); 
            // Nota: Si prefieres que la tabla se encoja si no hay clases tarde, 
            // usa: maxHora = Math.max(...fines);
            // Pero como pediste que "funcione hasta las 21", lo dejar√© din√°mico
            // basado en las clases insertadas o el l√≠mite superior.
             maxHora = Math.max(...fines);
        }

        let html = '<thead><tr class="character-header"><td></td>';
        for(let i=0; i<images.length; i++) {
            html += '<td><img src="' + images[i] + '" class="melody-icon" alt="img"></td>';
        }
        html += '</tr><tr><th class="time-header">Hora</th>';
        
        diasCompletos.forEach((dia, index) => {
            let corto = diasCortos[index];
            html += `<th>
                        <span class="day-long">${dia}</span>
                        <span class="day-short">${corto}</span>
                     </th>`;
        });
        html += '</tr></thead><tbody>';

        for(let h = minHora; h < maxHora; h++) {
            html += '<tr><td class="time-col">' + h + ':00</td>';
            diasCompletos.forEach(dia => {
                const claseFound = clases.find(c => c.dia === dia && h >= c.inicio && h < c.fin);
                if (claseFound) {
                    html += '<td><span class="materia">' + claseFound.materia + '</span><span class="salon">' + claseFound.salon + '</span></td>';
                } else {
                    html += `<td class="empty"></td>`;
                }
            });
            html += '</tr>';
        }
        html += '</tbody>';
        tabla.innerHTML = html;
    }

    window.onload = renderizarTabla;
</script>
</body>
</html>